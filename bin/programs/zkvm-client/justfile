set fallback := true

# default recipe to display help information
default:
  @just --list

# Run the client program natively with the hos
run-client-native l1_rpc_url beacon_rpc_url l2_rpc_url verbosity:
  #!/usr/bin/env bash

  # TODO: These configuration values are currently mocked. Once they're consumed,
  # update this to offer default run or optionally alter by pre-setting them.
  ROLLUP_CONFIG_PATH="./config.json"
  L2_GENESIS_PATH="./genesis.json"
  L1_HEAD=0xbe3e8018cedf5495244956a2fc9e21c24ef8dbf9a2b6f5f258ea52c58186defc
  L2_HEAD=0xcb3acb544e9683ed77dfc4f58853358489d02f2e5e275e1a55a101d74fcf91e7
  L2_OUTPUT_ROOT=0xa8bf8e6642a22da7f241ad21c15ad12656c6a2cd0a8aa9765d3436ddf20ee9cb
  L2_CLAIM=0x69bb5bf356632be020f60117092c37d320ee7d5673d0b1ff6426271adb537ec1
  L2_BLOCK_NUMBER=121572792
  L2_CHAIN_ID=10
  L1_NODE_ADDRESS={{l1_rpc_url}}
  L1_BEACON_ADDRESS={{beacon_rpc_url}}
  L2_NODE_ADDRESS={{l2_rpc_url}}
  DATA_DIR="./data"

  CLIENT_BIN_PATH="./target/release-client-lto/zkvm-client"

  echo "Building client program..."
  cargo build --profile release-client-lto
  echo "Running host program with native client program..."
  (cd ../../.. && cargo r --bin kona-host --release -- \
    --rollup-config $ROLLUP_CONFIG_PATH \
    --l2-genesis-path $L2_GENESIS_PATH \
    --network optimism \
    --l1-head $L1_HEAD \
    --l2-head $L2_HEAD \
    --l2-claim $L2_CLAIM \
    --l2-output-root $L2_OUTPUT_ROOT \
    --l2-block-number $L2_BLOCK_NUMBER \
    --l2-chain-id $L2_CHAIN_ID \
    --l1-node-address $L1_NODE_ADDRESS \
    --l1-beacon-address $L1_BEACON_ADDRESS \
    --l2-node-address $L2_NODE_ADDRESS \
    --data-dir $DATA_DIR \
    --exec $CLIENT_BIN_PATH \
    {{verbosity}})

  echo "Cleaning up..."
